# 0:00重複問題調査報告書

## 調査概要

**調査対象**: `analysis_results (17).zip`
**調査期間**: 2025年6月1日〜30日 (30日間)
**調査目的**: 夜勤と明け番の連続勤務で発生する0:00時刻での重複カウント問題の検証

## 主要な発見事項

### 1. 根本的な矛盾の発見

**Need計算システムの結果**:
- 0:00〜6:45の全時間帯で`Need = 0`
- 理論上、深夜時間帯にスタッフ配置は不要
- 7:00から`Need = 3`で通常勤務開始

**実際のスタッフ配置**:
- 0:00時刻に毎日**12-19人が配置**されている
- 平均15.3人/日の人員配置
- 30日間で一貫して人員が存在

### 2. 時間別人員分析結果

| 時刻  | 平均人員 | 最大人員 | 最小人員 | データ数 |
|-------|----------|----------|----------|----------|
| 23:45 | 15.3人   | 19人     | 12人     | 30日     |
| 00:00 | 15.3人   | 19人     | 12人     | 30日     |
| 00:15 | 15.3人   | 19人     | 12人     | 30日     |

### 3. 具体的な日別データ (6月前半)

```
2025-06-01: 15人
2025-06-02: 14人  
2025-06-03: 15人
2025-06-04: 15人
2025-06-05: 15人
2025-06-06: 16人
2025-06-07: 18人
2025-06-08: 15人
2025-06-09: 14人
2025-06-10: 16人
```

## 重複問題の分析

### 統計的重複の検証

**結果**: 0:00前後の時間帯(23:45, 00:00, 00:15)で人員数に差はなし
- 23:45 → 0:00: +0.0人差
- 0:00 → 0:15: +0.0人差
- 重複率: +0.0%

### 論理的矛盾の検証

**深刻な問題を発見**:
1. **Need=0なのにStaff>0の矛盾**
   - Need計算: 0:00は勤務不要
   - 実際配置: 平均15.3人が存在

2. **連続勤務パターンの確認**
   - work_patterns.csv: 36パターン中、夜勤関連パターン0%
   - 夜勤→明け番の連続勤務パターンが正しく認識されていない可能性

## 問題の定量化

### 月間影響度

- **日次過剰配置**: 15.3人/日
- **月間過剰時間**: 114.75人時間/月 (15.3人 × 30日 × 0.25時間)
- **年間過剰時間**: 1,377人時間/年

### 経済的影響 (推定)

時給2,000円と仮定した場合:
- **月間過剰コスト**: 229,500円
- **年間過剰コスト**: 2,754,000円

## 原因分析

### 1. システム設計の問題

**Need計算とスタッフ配置の分離**:
- Need計算: 業務量ベースで0:00は不要と判定
- スタッフ配置: 連続勤務を考慮して夜勤者を配置
- 両システム間の整合性不足

### 2. 連続勤務の境界処理問題

**夜勤パターンの処理**:
- 夜勤終了時刻の曖昧性
- 明け番開始時刻との重複
- 0:00跨ぎ勤務の不適切な処理

### 3. データ構造の問題

**時刻単位の処理限界**:
- 15分刻みの時間スロット処理
- 連続勤務の境界での離散化誤差
- リアルタイム勤務状況の反映不足

## 推奨される対策

### 1. 短期対策

**連続勤務の境界処理改善**:
- 夜勤終了時刻の明確化（例: 23:59で終了）
- 明け番開始時刻の調整（例: 0:01から開始）
- 0:00での重複カウント防止ロジック実装

### 2. 中期対策

**Need計算の精緻化**:
- 連続勤務パターンを考慮したNeed計算
- 夜勤者の最小必要人数設定
- 業務継続性を考慮した人員配置基準

### 3. 長期対策

**システム統合**:
- Need計算とスタッフ配置の統合システム
- リアルタイム勤務状況管理
- 連続勤務最適化アルゴリズム

## 検証の限界

### 1. データアクセスの制約

- pandas/openpyxlライブラリ利用不可
- Excel形式データの直接分析困難
- 詳細な時系列分析の制限

### 2. 勤務パターンデータの不足

- 個別職員の勤務履歴なし
- 夜勤→明け番の連続性確認困難
- 実際の勤務時間と記録時間の乖離不明

## 結論

### 重複問題の実態

**統計的重複**: 確認されず
**論理的重複**: **深刻な問題として確認**

0:00時刻での数値的な人員重複は確認されませんでしたが、**Need=0なのに実際には15.3人が配置されている根本的矛盾**を発見しました。これは以下を示唆しています：

1. **夜勤者の勤務時間が0:00を跨いでいる**
2. **Need計算が夜勤の実態を反映していない**
3. **連続勤務の境界処理に構造的問題がある**

### 影響度

- **月間**: 114.75人時間の過剰配置
- **経済的**: 年間約275万円の潜在的コスト
- **運用的**: シフト計画の精度低下

### 優先対応項目

1. **Need計算ロジックの見直し** (高優先度)
2. **連続勤務境界処理の改善** (高優先度)  
3. **夜勤パターン定義の明確化** (中優先度)
4. **システム統合の検討** (長期課題)

---

**報告者**: Claude Code Analysis System  
**報告日**: 2025年7月16日  
**調査データ**: analysis_results (17).zip - out_p25_based分析結果