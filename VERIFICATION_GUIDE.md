# çµ±ä¸€åˆ†æžç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  æ¤œè¨¼ã‚¬ã‚¤ãƒ‰

## ðŸŽ¯ æ¤œè¨¼ã®ç›®çš„
1. ä¸è¶³æ™‚é–“è¨ˆç®—ã®æ­£ç¢ºæ€§ç¢ºèª
2. å‹•çš„ã‚¹ãƒ­ãƒƒãƒˆè¨­å®šã®å‹•ä½œç¢ºèª
3. JSONå‡ºåŠ›ã®å“è³ªç¢ºèª
4. ã‚·ãƒŠãƒªã‚ªåˆ¥é›†è¨ˆã®æ­£ç¢ºæ€§ç¢ºèª

## ðŸ“‹ æ¤œè¨¼å‰ã®æº–å‚™

### 1. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®æº–å‚™
- å®Ÿéš›ã«ä½¿ç”¨ã—ã¦ã„ã‚‹Excelãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã§ãã‚Œã°å°è¦æ¨¡ãªã‚‚ã®ï¼‰
- ã¾ãŸã¯ä»˜å±žã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆ`ã‚·ãƒ¼ãƒˆ_ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿.xlsx`ãªã©ï¼‰

### 2. ç¾åœ¨ã®è¨­å®šç¢ºèª
```bash
# Gitã§ã®å¤‰æ›´çŠ¶æ³ç¢ºèª
git status

# çµ±ä¸€ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
ls -la shift_suite/tasks/unified_analysis_manager.py
```

---

## ðŸ”¬ æ¤œè¨¼æ‰‹é †

### æ¤œè¨¼1: åŸºæœ¬å‹•ä½œç¢ºèª

#### Step 1: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•
```bash
streamlit run app.py
```

#### Step 2: åˆæœŸè¨­å®šç¢ºèª
1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ã
2. ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã€Œã‚¹ãƒ­ãƒƒãƒˆé–“éš”ã€è¨­å®šã‚’ç¢ºèªï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 30åˆ†ï¼‰
3. å€¤ã‚’å¤‰æ›´ã—ã¦ã¿ã‚‹ï¼ˆä¾‹: 15åˆ†ã€60åˆ†ï¼‰

#### æœŸå¾…ã•ã‚Œã‚‹çµæžœ:
- ã‚¹ãƒ­ãƒƒãƒˆé–“éš”ãŒ5ã€œ1440åˆ†ã®ç¯„å›²ã§è¨­å®šå¯èƒ½
- è¨­å®šå€¤ãŒä¿æŒã•ã‚Œã‚‹

---

### æ¤œè¨¼2: å®Ÿãƒ‡ãƒ¼ã‚¿ã«ã‚ˆã‚‹è¨ˆç®—ç²¾åº¦æ¤œè¨¼

#### Step 1: å°è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
1. ãƒ†ã‚¹ãƒˆç”¨Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
2. å¿…è¦äººæ•°ã®è¨ˆç®—æ–¹æ³•ã‚’ã€Œçµ±è¨ˆçš„æŽ¨å®šã€ã«è¨­å®š
3. ä»¥ä¸‹ã®åˆ†æžã‚’æœ‰åŠ¹åŒ–:
   - âœ… ä¸è¶³åˆ†æž
   - âœ… ç–²åŠ´åˆ†æž
   - âœ… å…¬å¹³æ€§åˆ†æž
4. ã€Œåˆ†æžã‚’å®Ÿè¡Œã€ã‚’ã‚¯ãƒªãƒƒã‚¯

#### Step 2: ä¸è¶³æ™‚é–“ã®ç¢ºèª
1. åˆ†æžå®Œäº†å¾Œã€ã€Œä¸è¶³åˆ†æžã€ã‚¿ãƒ–ã‚’é–‹ã
2. è¡¨ç¤ºã•ã‚Œã‚‹æ•°å€¤ã‚’è¨˜éŒ²:
   - ç·ä¸è¶³æ™‚é–“
   - å½¹è·åˆ¥ä¸è¶³æ™‚é–“
   - proportionalåˆ†æžã®çµæžœ

#### Step 3: è¨ˆç®—ã®å¦¥å½“æ€§ç¢ºèª
```python
# ç°¡æ˜“æ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆ
cat > verify_shortage_calculation.py << 'EOF'
import pandas as pd
from pathlib import Path

# çµæžœãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿
result_dir = Path("out/YOUR_FILE_NAME/scenario_default")
if result_dir.exists():
    # ä¸è¶³åˆ†æžçµæžœã®ç¢ºèª
    shortage_files = list(result_dir.glob("*shortage*.xlsx"))
    for file in shortage_files:
        print(f"\n=== {file.name} ===")
        df = pd.read_excel(file)
        print(df.head())
        if 'lack_h' in df.columns:
            total = df['lack_h'].sum()
            print(f"ç·ä¸è¶³æ™‚é–“: {total:.2f}æ™‚é–“")
            print(f"æœ€å¤§ä¸è¶³: {df['lack_h'].max():.2f}æ™‚é–“")
            print(f"å¹³å‡ä¸è¶³: {df['lack_h'].mean():.2f}æ™‚é–“")
EOF

python3 verify_shortage_calculation.py
```

#### æœŸå¾…ã•ã‚Œã‚‹çµæžœ:
- ä¸è¶³æ™‚é–“ãŒç¾å®Ÿçš„ãªç¯„å›²å†…ï¼ˆä¾‹: æœˆé–“ã§0ã€œ500æ™‚é–“ç¨‹åº¦ï¼‰
- å½¹è·åˆ¥ã®ä¸è¶³æ™‚é–“ãŒå¦¥å½“
- ã‚¹ãƒ­ãƒƒãƒˆé–“éš”ã‚’å¤‰æ›´ã—ã¦ã‚‚ã€æ™‚é–“æ›ç®—ãŒæ­£ã—ã„

---

### æ¤œè¨¼3: JSONå‡ºåŠ›å†…å®¹ã®å®Ÿæ…‹ç¢ºèª

#### Step 1: AIåŒ…æ‹¬ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆç¢ºèª
1. åˆ†æžå®Ÿè¡Œå¾Œã€çµæžœç”»é¢ã‚’ç¢ºèª
2. ã€ŒAIå‘ã‘åˆ†æžçµæžœï¼ˆJSONï¼‰ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æŽ¢ã™

#### Step 2: JSONå†…å®¹ã®æ¤œè¨¼
```python
# JSONå‡ºåŠ›ç¢ºèªã‚¹ã‚¯ãƒªãƒ—ãƒˆ
cat > verify_json_output.py << 'EOF'
import json
from pathlib import Path

# çµæžœãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ç¢ºèª
result_dirs = list(Path("out").glob("*/scenario_*"))
for result_dir in result_dirs:
    json_files = list(result_dir.glob("*comprehensive*.json"))
    for json_file in json_files:
        print(f"\n=== {json_file} ===")
        with open(json_file, 'r', encoding='utf-8') as f:
            data = json.load(f)
        
        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®ãƒã‚§ãƒƒã‚¯
        def check_defaults(obj, path=""):
            if isinstance(obj, dict):
                for k, v in obj.items():
                    if v == 0 or v == 0.0 or v == "N/A" or v == "default":
                        print(f"âš ï¸ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤æ¤œå‡º: {path}.{k} = {v}")
                    elif isinstance(v, (dict, list)):
                        check_defaults(v, f"{path}.{k}")
            elif isinstance(obj, list):
                for i, item in enumerate(obj):
                    check_defaults(item, f"{path}[{i}]")
        
        check_defaults(data)
        
        # ä¸»è¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ç¢ºèª
        if 'shortage_analysis' in data:
            shortage = data['shortage_analysis']
            print(f"ä¸è¶³æ™‚é–“: {shortage.get('total_shortage_hours', 'ãªã—')}")
            print(f"ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§: {shortage.get('data_integrity', 'ãªã—')}")
EOF

python3 verify_json_output.py
```

#### æœŸå¾…ã•ã‚Œã‚‹çµæžœ:
- JSONå†…ã«å®Ÿéš›ã®åˆ†æžçµæžœãŒå«ã¾ã‚Œã¦ã„ã‚‹
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆ0, "N/A", "default"ï¼‰ãŒæœ€å°é™
- data_integrityãŒ"valid"ã«ãªã£ã¦ã„ã‚‹

---

### æ¤œè¨¼4: ã‚·ãƒŠãƒªã‚ªåˆ¥é›†è¨ˆã®ç¢ºèª

#### Step 1: è¤‡æ•°ã‚·ãƒŠãƒªã‚ªã§ã®ãƒ†ã‚¹ãƒˆ
1. ç•°ãªã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§2å›žä»¥ä¸Šåˆ†æžã‚’å®Ÿè¡Œ
2. å„å®Ÿè¡Œã§ç•°ãªã‚‹ã‚¹ãƒ­ãƒƒãƒˆé–“éš”ã‚’è¨­å®šï¼ˆä¾‹: 30åˆ†ã€60åˆ†ï¼‰

#### Step 2: çµæžœã®æ¯”è¼ƒ
```bash
# çµæžœãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ§‹é€ ç¢ºèª
ls -la out/*/scenario_*/

# å„ã‚·ãƒŠãƒªã‚ªã®çµæžœç¢ºèª
find out -name "*shortage*.xlsx" -exec echo "=== {} ===" \; -exec head -5 {} \;
```

#### æœŸå¾…ã•ã‚Œã‚‹çµæžœ:
- å„ã‚·ãƒŠãƒªã‚ªã®çµæžœãŒç‹¬ç«‹ã—ã¦ä¿å­˜ã•ã‚Œã¦ã„ã‚‹
- proportionalåˆ†æžãŒå„ã‚·ãƒŠãƒªã‚ªå†…ã§å®Œçµã—ã¦ã„ã‚‹
- ã‚·ãƒŠãƒªã‚ªé–“ã§çµæžœãŒæ··åŒã•ã‚Œã¦ã„ãªã„

---

### æ¤œè¨¼5: å‹•çš„ã‚¹ãƒ­ãƒƒãƒˆè¨­å®šã®ä¼æ’­ç¢ºèª

#### Step 1: ãƒ­ã‚°ç¢ºèªã«ã‚ˆã‚‹å‹•çš„è¨­å®šã®è¿½è·¡
```bash
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ™‚ã®ãƒ­ã‚°ã‚’ç¢ºèª
streamlit run app.py 2>&1 | grep -E "slot|ã‚¹ãƒ­ãƒƒãƒˆ"
```

#### Step 2: å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã®è¨­å®šç¢ºèª
```python
# å‹•çš„ã‚¹ãƒ­ãƒƒãƒˆç¢ºèªã‚¹ã‚¯ãƒªãƒ—ãƒˆ
cat > verify_slot_propagation.py << 'EOF'
import re
from pathlib import Path

# å„åˆ†æžãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã®ã‚¹ãƒ­ãƒƒãƒˆå‡¦ç†ç¢ºèª
modules = [
    "shift_suite/tasks/shortage.py",
    "shift_suite/tasks/fatigue.py",
    "shift_suite/tasks/heatmap.py"
]

for module_path in modules:
    if Path(module_path).exists():
        print(f"\n=== {module_path} ===")
        with open(module_path, 'r', encoding='utf-8') as f:
            content = f.read()
        
        # ã‚¹ãƒ­ãƒƒãƒˆé–¢é€£ã®å‡¦ç†ã‚’æ¤œç´¢
        slot_patterns = [
            r'slot_minutes.*=.*(\d+)',
            r'slot_hours.*=.*slot.*60',
            r'SLOT_HOURS',  # å›ºå®šå€¤ã®æ®‹å­˜ãƒã‚§ãƒƒã‚¯
        ]
        
        for pattern in slot_patterns:
            matches = re.findall(pattern, content)
            if matches:
                print(f"  {pattern}: {len(matches)}ç®‡æ‰€")
EOF

python3 verify_slot_propagation.py
```

#### æœŸå¾…ã•ã‚Œã‚‹çµæžœ:
- SLOT_HOURSï¼ˆå›ºå®šå€¤ï¼‰ã®ä½¿ç”¨ãŒ0ç®‡æ‰€
- slot_minutes/slot_hoursã®å‹•çš„è¨ˆç®—ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

---

## ðŸ“Š æ¤œè¨¼çµæžœã®è¨˜éŒ²

### æ¤œè¨¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

| æ¤œè¨¼é …ç›® | çµæžœ | å‚™è€ƒ |
|---------|------|------|
| ã‚¢ãƒ—ãƒªèµ·å‹• | â–¡ OK / â–¡ NG | |
| ã‚¹ãƒ­ãƒƒãƒˆè¨­å®šå¤‰æ›´ | â–¡ OK / â–¡ NG | |
| ä¸è¶³æ™‚é–“è¨ˆç®— | â–¡ OK / â–¡ NG | è¨ˆç®—å€¤: ___æ™‚é–“ |
| JSONå‡ºåŠ›å“è³ª | â–¡ OK / â–¡ NG | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤: ___å€‹ |
| ã‚·ãƒŠãƒªã‚ªç‹¬ç«‹æ€§ | â–¡ OK / â–¡ NG | |
| å‹•çš„è¨­å®šä¼æ’­ | â–¡ OK / â–¡ NG | |

### å•é¡Œç™ºè¦‹æ™‚ã®è¨˜éŒ²
```
ç™ºè¦‹æ—¥æ™‚: 
å•é¡Œã®å†…å®¹:
å†ç¾æ‰‹é †:
æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ:
å®Ÿéš›ã®å‹•ä½œ:
ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆã‚ã‚Œã°ï¼‰:
```

---

## ðŸš¨ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨å¯¾å‡¦æ³•

#### 1. ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ãªã„
```bash
# ä¾å­˜é–¢ä¿‚ã®ç¢ºèª
pip list | grep -E "streamlit|pandas|numpy"

# å¿…è¦ã«å¿œã˜ã¦å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt
```

#### 2. åˆ†æžãŒé€”ä¸­ã§æ­¢ã¾ã‚‹
- ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ç¢ºèªï¼ˆF12ï¼‰
- `shift_suite.log`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’ç¢ºèª

#### 3. çµæžœãŒè¡¨ç¤ºã•ã‚Œãªã„
- `out`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ¨©é™ã‚’ç¢ºèª
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒ¼ãƒˆã‚’ã‚¯ãƒªã‚¢ï¼ˆã‚¢ãƒ—ãƒªå†èµ·å‹•ï¼‰

---

## ðŸ“ æ¤œè¨¼å¾Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### å•é¡ŒãŒè¦‹ã¤ã‹ã£ãŸå ´åˆ
1. ä¸Šè¨˜ã®ã€Œå•é¡Œç™ºè¦‹æ™‚ã®è¨˜éŒ²ã€ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã§è©³ç´°ã‚’è¨˜éŒ²
2. å¯èƒ½ã§ã‚ã‚Œã°ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®å½±
3. `shift_suite.log`ã®è©²å½“éƒ¨åˆ†ã‚’ã‚³ãƒ”ãƒ¼

### å•é¡ŒãŒãªã‹ã£ãŸå ´åˆ
1. æ¤œè¨¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ã™ã¹ã¦ã€ŒOKã€ã§åŸ‹ã‚ã‚‹
2. ä½¿ç”¨ã—ãŸãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®æ¦‚è¦ã‚’è¨˜éŒ²
3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ï¼ˆå‡¦ç†æ™‚é–“ï¼‰ã‚’è¨˜éŒ²

---

## ðŸ’¡ è¿½åŠ ã®æ¤œè¨¼ã‚¢ã‚¤ãƒ‡ã‚¢

### é«˜åº¦ãªæ¤œè¨¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
1. **å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆ**: 1ãƒ¶æœˆä»¥ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã§æ¤œè¨¼
2. **å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆ**: ã‚¹ãƒ­ãƒƒãƒˆé–“éš”ã‚’æ¥µç«¯ãªå€¤ï¼ˆ5åˆ†ã€1440åˆ†ï¼‰ã§æ¤œè¨¼
3. **ä¸¦è¡Œå®Ÿè¡Œãƒ†ã‚¹ãƒˆ**: è¤‡æ•°ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚¿ãƒ–ã§åŒæ™‚å®Ÿè¡Œ
4. **ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆ**: é€£ç¶š10å›žã®åˆ†æžå®Ÿè¡Œ

### å®šé‡çš„æ¤œè¨¼
```python
# å‡¦ç†æ™‚é–“ã®è¨ˆæ¸¬
import time
start = time.time()
# åˆ†æžå®Ÿè¡Œ
end = time.time()
print(f"å‡¦ç†æ™‚é–“: {end - start:.2f}ç§’")
```

---

ã“ã®ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦æ¤œè¨¼ã‚’å®Ÿæ–½ã—ã€çµæžœã‚’è¨˜éŒ²ã—ã¦ãã ã•ã„ã€‚
å•é¡ŒãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã¯ã€å…·ä½“çš„ãªå†ç¾æ‰‹é †ã¨å…±ã«å ±å‘Šã—ã¦ãã ã•ã„ã€‚