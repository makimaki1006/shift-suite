#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æ ¹æœ¬çš„è¨ˆç®—æ–¹æ³•ç›£æŸ» - éä¸è¶³è¨ˆç®—ã®åŸºç›¤è¨­è¨ˆæ¤œè¨¼
æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã®è¨ˆç®—æ–¹æ³•ã¨Phase 2å®Ÿè£…ã®æ•´åˆæ€§æ¤œè¨¼
"""

from pathlib import Path
import json

def audit_fundamental_calculation_logic():
    """æ ¹æœ¬çš„ãªè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã®ç›£æŸ»"""
    
    print("=" * 120)
    print("ğŸ” æ ¹æœ¬çš„è¨ˆç®—æ–¹æ³•ç›£æŸ» - éä¸è¶³è¨ˆç®—ã®åŸºç›¤è¨­è¨ˆæ¤œè¨¼")
    print("=" * 120)
    
    # 1. ã‚¹ãƒ­ãƒƒãƒˆæ¦‚å¿µã®è¨­è¨ˆå¦¥å½“æ€§åˆ†æ
    analyze_slot_concept_validity()
    
    # 2. æ™‚é–“å¤‰æ›ã®ä¸€è²«æ€§æ¤œè¨¼  
    analyze_time_conversion_consistency()
    
    # 3. long_dfè¨­è¨ˆã®å¦¥å½“æ€§æ¤œè¨¼
    analyze_long_df_design_validity()
    
    # 4. parsed_slots_countã®æ„å‘³æ¤œè¨¼
    analyze_parsed_slots_count_meaning()
    
    # 5. Phase 2å®Ÿè£…ã¨ã®æ•´åˆæ€§æ¤œè¨¼
    analyze_phase2_implementation_consistency()

def analyze_slot_concept_validity():
    """ã‚¹ãƒ­ãƒƒãƒˆæ¦‚å¿µã®è¨­è¨ˆå¦¥å½“æ€§åˆ†æ"""
    
    print("\nğŸ“Š ã‚¹ãƒ­ãƒƒãƒˆæ¦‚å¿µã®è¨­è¨ˆå¦¥å½“æ€§åˆ†æ")
    print("-" * 100)
    
    slot_analysis = {
        "ç¾åœ¨ã®è¨­è¨ˆ": {
            "ã‚¹ãƒ­ãƒƒãƒˆå˜ä½": "30åˆ† (DEFAULT_SLOT_MINUTES = 30)",
            "æ™‚é–“å¤‰æ›": "SLOT_HOURS = 0.5æ™‚é–“",
            "æƒ³å®šç”¨é€”": "ã‚·ãƒ•ãƒˆæ™‚é–“å¸¯ã®æœ€å°å˜ä½ã¨ã—ã¦ä½¿ç”¨",
            "è¨ˆç®—å¼": "åŠ´åƒæ™‚é–“ = ã‚¹ãƒ­ãƒƒãƒˆæ•° Ã— 0.5æ™‚é–“"
        },
        "è¨­è¨ˆã®å¦¥å½“æ€§è©•ä¾¡": {
            "æ¥­ç•Œæ¨™æº–é©åˆæ€§": "ğŸŸ¡ éƒ¨åˆ†çš„",
            "è©³ç´°": [
                "âœ… 30åˆ†å˜ä½ã¯çœ‹è­·ãƒ»ä»‹è­·æ¥­ç•Œã§ä¸€èˆ¬çš„",
                "âš ï¸ é€£ç¶šã‚·ãƒ•ãƒˆï¼ˆ8æ™‚é–“å‹¤å‹™ç­‰ï¼‰ã®è¡¨ç¾ãŒå†—é•·",
                "âŒ ä¼‘æ†©æ™‚é–“ã®æ‰±ã„ãŒä¸æ˜ç¢º",
                "âŒ å¤œå‹¤è·¨ãã‚·ãƒ•ãƒˆã®æ—¥ä»˜å¢ƒç•Œå•é¡Œ"
            ]
        },
        "ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ": {
            "äºŒé‡å¤‰æ›ãƒªã‚¹ã‚¯": "ğŸ”´ é«˜ãƒªã‚¹ã‚¯",
            "å•é¡Œå†…å®¹": [
                "shortage.pyã§æ—¢ã«æ™‚é–“å˜ä½ã«å¤‰æ›æ¸ˆã¿",
                "dash_app.pyã§å†åº¦SLOT_HOURSã‚’ä¹—ç®—ã™ã‚‹å¯èƒ½æ€§",
                "Phase 2å®Ÿè£…ã§ã‚‚åŒæ§˜ã®ãƒªã‚¹ã‚¯",
                "ãƒ‡ãƒ¼ã‚¿ã®æ„å‘³ï¼ˆæ™‚é–“ vs ã‚¹ãƒ­ãƒƒãƒˆæ•°ï¼‰ãŒæ›–æ˜§"
            ],
            "å½±éŸ¿ç¯„å›²": "å…¨åˆ†æçµæœã®æ•°å€¤çš„æ­£ç¢ºæ€§ã«å½±éŸ¿"
        }
    }
    
    for category, details in slot_analysis.items():
        print(f"\nğŸ¯ {category}:")
        if isinstance(details, dict):
            for key, value in details.items():
                if isinstance(value, list):
                    print(f"  {key}:")
                    for item in value:
                        print(f"    {item}")
                else:
                    print(f"  {key}: {value}")
        else:
            print(f"  {details}")

def analyze_time_conversion_consistency():
    """æ™‚é–“å¤‰æ›ã®ä¸€è²«æ€§æ¤œè¨¼"""
    
    print(f"\nâ° æ™‚é–“å¤‰æ›ã®ä¸€è²«æ€§æ¤œè¨¼")
    print("-" * 100)
    
    # æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®æ™‚é–“å¤‰æ›ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æ
    conversion_patterns = {
        "shortage.py (v2.7.0)": {
            "å¤‰æ›æ–¹æ³•": "slot_hours = slot / 60.0",
            "ä¿å­˜å½¢å¼": "lack_h (æ™‚é–“å˜ä½)",
            "è¨ˆç®—å¼": "total_lack_hours = (lack_count * slot_hours).sum().sum()",
            "æœ€çµ‚å€¤": "æ™‚é–“å˜ä½ã§ä¿å­˜ãƒ»è¡¨ç¤º"
        },
        "constants.py": {
            "å®šç¾©": "SLOT_HOURS = DEFAULT_SLOT_MINUTES / 60.0",
            "å€¤": "30åˆ† â†’ 0.5æ™‚é–“",
            "ç”¨é€”": "å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã®çµ±ä¸€çš„ãªæ™‚é–“å¤‰æ›"
        },
        "fact_extractor_prototype.py (Phase 2)": {
            "å®Ÿè£…": "total_hours = group['parsed_slots_count'].sum() * SLOT_HOURS",
            "å‰æ": "parsed_slots_countãŒã‚¹ãƒ­ãƒƒãƒˆæ•°",
            "å•é¡Œ": "parsed_slots_countãŒæ—¢ã«æ™‚é–“å˜ä½ã®å ´åˆã€äºŒé‡å¤‰æ›"
        },
        "lightweight_anomaly_detector.py (Phase 3.1)": {
            "å®Ÿè£…": "monthly_hours = work_df.groupby(['staff', 'year_month'])['parsed_slots_count'].sum() * SLOT_HOURS",
            "åŒæ§˜å•é¡Œ": "parsed_slots_countã®æ„å‘³ãŒä¸æ˜ç¢º"
        }
    }
    
    print("ğŸ“‹ å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã®æ™‚é–“å¤‰æ›ãƒ‘ã‚¿ãƒ¼ãƒ³:")
    for module, pattern in conversion_patterns.items():
        print(f"\n  ğŸ”§ {module}:")
        for key, value in pattern.items():
            print(f"    {key}: {value}")
    
    # ä¸æ•´åˆã®æ¤œå‡º
    print(f"\nâš ï¸ æ¤œå‡ºã•ã‚ŒãŸä¸æ•´åˆ:")
    inconsistencies = [
        {
            "å•é¡Œ": "parsed_slots_countã®æ„å‘³ã®æ›–æ˜§æ€§",
            "è©³ç´°": "ã‚¹ãƒ­ãƒƒãƒˆæ•°ãªã®ã‹ã€æ—¢ã«æ™‚é–“å˜ä½ãªã®ã‹ãŒä¸æ˜ç¢º",
            "å½±éŸ¿": "äºŒé‡å¤‰æ›ã«ã‚ˆã‚‹è¨ˆç®—èª¤å·®",
            "é‡è¦åº¦": "ğŸ”´ ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«"
        },
        {
            "å•é¡Œ": "ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã§ã®æ™‚é–“å¤‰æ›ã®ä¸çµ±ä¸€",
            "è©³ç´°": "shortage.pyã¨Phase 2å®Ÿè£…ã§ç•°ãªã‚‹å‰æ",
            "å½±éŸ¿": "åˆ†æçµæœã®æ•°å€¤çš„ä¸æ•´åˆ",
            "é‡è¦åº¦": "ğŸ”´ ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«"
        },
        {
            "å•é¡Œ": "ãƒ‡ãƒ¼ã‚¿ã®å˜ä½æƒ…å ±ã®æ¬ å¦‚",
            "è©³ç´°": "long_dfã®ã‚«ãƒ©ãƒ ã«å˜ä½æƒ…å ±ãŒãªã„",
            "å½±éŸ¿": "é–‹ç™ºè€…ã®æ··ä¹±ã€ãƒã‚°ã®æ¸©åºŠ",
            "é‡è¦åº¦": "ğŸŸ¡ ãƒ¡ã‚¸ãƒ£ãƒ¼"
        }
    ]
    
    for inconsistency in inconsistencies:
        print(f"  {inconsistency['é‡è¦åº¦']} {inconsistency['å•é¡Œ']}")
        print(f"    è©³ç´°: {inconsistency['è©³ç´°']}")
        print(f"    å½±éŸ¿: {inconsistency['å½±éŸ¿']}")

def analyze_long_df_design_validity():
    """long_dfè¨­è¨ˆã®å¦¥å½“æ€§æ¤œè¨¼"""
    
    print(f"\nğŸ“Š long_dfè¨­è¨ˆã®å¦¥å½“æ€§æ¤œè¨¼")
    print("-" * 100)
    
    long_df_analysis = {
        "ç¾åœ¨ã®è¨­è¨ˆ": {
            "å¿…é ˆã‚«ãƒ©ãƒ ": [
                "ds (æ—¥æ™‚)",
                "staff (è·å“¡ID)",
                "role (è·ç¨®)",
                "code (å‹¤å‹™ã‚³ãƒ¼ãƒ‰)",
                "holiday_type (ä¼‘æ—¥ç¨®åˆ¥)",
                "parsed_slots_count (ã‚¹ãƒ­ãƒƒãƒˆæ•°ï¼Ÿæ™‚é–“ï¼Ÿ)"
            ],
            "ãƒ‡ãƒ¼ã‚¿å½¢å¼": "é•·å½¢å¼ï¼ˆå„ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒ1ã¤ã®å‹¤å‹™æ™‚é–“å¸¯ï¼‰",
            "æƒ³å®š": "1ãƒ¬ã‚³ãƒ¼ãƒ‰ = 1ã‚¹ãƒ­ãƒƒãƒˆæœŸé–“ã®å‹¤å‹™"
        },
        "è¨­è¨ˆã®å•é¡Œç‚¹": {
            "ãƒ‡ãƒ¼ã‚¿æ„å‘³ã®æ›–æ˜§æ€§": [
                "parsed_slots_countãŒä½•ã‚’è¡¨ã™ã‹ä¸æ˜ç¢º",
                "1ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒä½•æ™‚é–“ã®å‹¤å‹™ã‚’è¡¨ã™ã‹ä¸æ˜",
                "ä¼‘æ†©æ™‚é–“ã®æ‰±ã„ãŒä¸æ˜",
                "é€£ç¶šå‹¤å‹™ã®å¢ƒç•ŒãŒä¸æ˜ç¢º"
            ],
            "ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£å•é¡Œ": [
                "8æ™‚é–“å‹¤å‹™ = 16ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆ30åˆ†ã‚¹ãƒ­ãƒƒãƒˆï¼‰",
                "å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã§ã®å‡¦ç†åŠ¹ç‡æ‚ªåŒ–",
                "ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®å¢—å¤§"
            ],
            "æ¥­å‹™å®Ÿæ…‹ã¨ã®ä¹–é›¢": [
                "å®Ÿéš›ã®ã‚·ãƒ•ãƒˆä½œæˆã¯æ™‚é–“å˜ä½",
                "30åˆ†åˆ»ã¿ã®è©³ç´°ç®¡ç†ã¯ç¾å®Ÿçš„ã§ãªã„",
                "å‹¤å‹™å®Ÿç¸¾ã¨ç®¡ç†å˜ä½ã®ä¸ä¸€è‡´"
            ]
        },
        "ä»£æ›¿è¨­è¨ˆæ¡ˆ": {
            "æ™‚é–“ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ": {
                "ã‚«ãƒ©ãƒ ": "start_time, end_time, duration_hours",
                "åˆ©ç‚¹": "ç›´æ„Ÿçš„ã€è¨ˆç®—åŠ¹ç‡è‰¯ã„ã€æ¥­å‹™å®Ÿæ…‹ã«åˆè‡´"
            },
            "é›†ç´„å‹è¨­è¨ˆ": {
                "ã‚«ãƒ©ãƒ ": "date, staff, role, total_hours, shift_count",
                "åˆ©ç‚¹": "ãƒ‡ãƒ¼ã‚¿é‡å‰Šæ¸›ã€å‡¦ç†é«˜é€ŸåŒ–"
            }
        }
    }
    
    for category, details in long_df_analysis.items():
        print(f"\nğŸ¯ {category}:")
        if isinstance(details, dict):
            for key, value in details.items():
                print(f"  {key}:")
                if isinstance(value, list):
                    for item in value:
                        print(f"    â€¢ {item}")
                else:
                    print(f"    {value}")
        else:
            print(f"  {details}")

def analyze_parsed_slots_count_meaning():
    """parsed_slots_countã®æ„å‘³æ¤œè¨¼"""
    
    print(f"\nğŸ” parsed_slots_countã®æ„å‘³æ¤œè¨¼")
    print("-" * 100)
    
    # ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ã®åˆ†æã‚’é€šã˜ã¦parsed_slots_countã®ä½¿ã‚ã‚Œæ–¹ã‚’èª¿æŸ»
    usage_patterns = {
        "Phase 2å®Ÿè£…ã§ã®ä½¿ç”¨": {
            "è¨ˆç®—å¼": "total_hours = group['parsed_slots_count'].sum() * SLOT_HOURS",
            "å‰æ": "parsed_slots_countã¯ã‚¹ãƒ­ãƒƒãƒˆæ•°",
            "çµæœ": "æ™‚é–“å˜ä½ã®åŠ´åƒæ™‚é–“"
        },
        "Phase 3.1å®Ÿè£…ã§ã®ä½¿ç”¨": {
            "è¨ˆç®—å¼": "monthly_hours = groupby(['staff', 'year_month'])['parsed_slots_count'].sum() * SLOT_HOURS",
            "å‰æ": "åŒæ§˜ã«ã‚¹ãƒ­ãƒƒãƒˆæ•°ã¨ã—ã¦æ‰±ã†",
            "çµæœ": "æœˆé–“åŠ´åƒæ™‚é–“"
        },
        "æ¨å®šã•ã‚Œã‚‹æ„å‘³": {
            "ä»®èª¬1": "ã‚¹ãƒ­ãƒƒãƒˆæ•°ï¼ˆæ•´æ•°å€¤ã€30åˆ†åˆ»ã¿ï¼‰",
            "ä»®èª¬2": "æ™‚é–“å€¤ï¼ˆå°æ•°å€¤ã€æ™‚é–“å˜ä½ï¼‰",
            "ä»®èª¬3": "åˆ†æ•°å€¤ï¼ˆæ•´æ•°å€¤ã€åˆ†å˜ä½ï¼‰"
        }
    }
    
    print("ğŸ“‹ parsed_slots_countã®ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ:")
    for pattern_name, pattern_detail in usage_patterns.items():
        print(f"\n  ğŸ”§ {pattern_name}:")
        for key, value in pattern_detail.items():
            print(f"    {key}: {value}")
    
    # æ¤œè¨¼æ–¹æ³•ã®ææ¡ˆ
    print(f"\nğŸ¯ æ¤œè¨¼ãŒå¿…è¦ãªé …ç›®:")
    verification_items = [
        "å®Ÿéš›ã®long_dfã‚µãƒ³ãƒ—ãƒ«ã§ã®parsed_slots_countã®å€¤ã®ç¢ºèª",
        "30åˆ†å‹¤å‹™æ™‚ã®parsed_slots_countãŒ1ãªã®ã‹0.5ãªã®ã‹",
        "8æ™‚é–“å‹¤å‹™æ™‚ã®åˆè¨ˆå€¤ãŒ16ãªã®ã‹8ãªã®ã‹",
        "æ—¢å­˜ã®shortage.pyã§ã®è¨ˆç®—çµæœã¨ã®æ•´åˆæ€§",
        "å®Ÿãƒ‡ãƒ¼ã‚¿ã§ã®æ•°å€¤ãƒ¬ãƒ³ã‚¸ã®ç¢ºèª"
    ]
    
    for i, item in enumerate(verification_items, 1):
        print(f"  {i}. {item}")

def analyze_phase2_implementation_consistency():
    """Phase 2å®Ÿè£…ã¨ã®æ•´åˆæ€§æ¤œè¨¼"""
    
    print(f"\nğŸ”§ Phase 2å®Ÿè£…ã¨ã®æ•´åˆæ€§æ¤œè¨¼")
    print("-" * 100)
    
    consistency_analysis = {
        "å®Ÿè£…å‰æã®ç¢ºèª": {
            "Phase 2ã®å‰æ": "parsed_slots_countã¯ã‚¹ãƒ­ãƒƒãƒˆæ•°",
            "è¨ˆç®—æ–¹æ³•": "æ™‚é–“ = ã‚¹ãƒ­ãƒƒãƒˆæ•° Ã— 0.5",
            "æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ": "shortage.pyã¯æ—¢ã«æ™‚é–“å˜ä½ã§ä¿å­˜",
            "çŸ›ç›¾": "äºŒé‡å¤‰æ›ã®å¯èƒ½æ€§"
        },
        "å…·ä½“çš„ãªå•é¡Œç®‡æ‰€": {
            "fact_extractor_prototype.py:98": {
                "ã‚³ãƒ¼ãƒ‰": "total_hours = group['parsed_slots_count'].sum() * SLOT_HOURS",
                "å•é¡Œ": "parsed_slots_countãŒæ—¢ã«æ™‚é–“å˜ä½ãªã‚‰äºŒé‡å¤‰æ›",
                "ä¿®æ­£æ¡ˆ": "ãƒ‡ãƒ¼ã‚¿ã®æ„å‘³ã‚’ç¢ºèªã—ã¦ã‹ã‚‰è¨ˆç®—æ–¹æ³•æ±ºå®š"
            },
            "lightweight_anomaly_detector.py:132": {
                "ã‚³ãƒ¼ãƒ‰": "monthly_hours = work_df.groupby(['staff', 'year_month'])['parsed_slots_count'].sum() * SLOT_HOURS",
                "å•é¡Œ": "åŒæ§˜ã®äºŒé‡å¤‰æ›ãƒªã‚¹ã‚¯",
                "ä¿®æ­£æ¡ˆ": "çµ±ä¸€çš„ãªãƒ‡ãƒ¼ã‚¿è§£é‡ˆã®ç¢ºç«‹"
            }
        },
        "å½±éŸ¿è©•ä¾¡": {
            "æ•°å€¤ç²¾åº¦": "50%ã®èª¤å·®ï¼ˆ0.5å€ã¾ãŸã¯2å€ï¼‰ã®å¯èƒ½æ€§",
            "æ³•çš„æº–æ‹ ": "åŠ´åƒæ™‚é–“ã®èª¤ç®—ã«ã‚ˆã‚Šæ³•çš„åŸºæº–åˆ¤å®šã‚‚èª¤ã‚‹",
            "ãƒ“ã‚¸ãƒã‚¹å½±éŸ¿": "ã‚³ã‚¹ãƒˆè¨ˆç®—ã€äººå“¡è¨ˆç”»ã®æ ¹æœ¬çš„èª¤ã‚Š",
            "ä¿¡é ¼æ€§": "ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®æ•°å€¤çš„ä¿¡é ¼æ€§ã«ç–‘ç¾©"
        },
        "ç·Šæ€¥å¯¾å¿œãŒå¿…è¦ãªç†ç”±": {
            "1": "æ—¢ã«çµ±åˆæ¸ˆã¿ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã®è¨ˆç®—èª¤å·®",
            "2": "æ³•çš„æº–æ‹ ãƒã‚§ãƒƒã‚¯ã®æ ¹æœ¬çš„ãªä¿¡é ¼æ€§å•é¡Œ",
            "3": "çµŒå–¶åˆ¤æ–­ã«ç›´çµã™ã‚‹æ•°å€¤ã®æ­£ç¢ºæ€§å•é¡Œ",
            "4": "ç¬¬ä¸‰è€…æ¤œè¨¼ã§95.2%ã ã£ãŸå“è³ªè©•ä¾¡ã®å†è©•ä¾¡ãŒå¿…è¦"
        }
    }
    
    for category, details in consistency_analysis.items():
        print(f"\nğŸ¯ {category}:")
        if isinstance(details, dict):
            for key, value in details.items():
                if isinstance(value, dict):
                    print(f"  {key}:")
                    for subkey, subvalue in value.items():
                        print(f"    {subkey}: {subvalue}")
                else:
                    print(f"  {key}: {value}")

def generate_fundamental_audit_summary():
    """æ ¹æœ¬çš„ç›£æŸ»ã®ã‚µãƒãƒªãƒ¼ç”Ÿæˆ"""
    
    print(f"\nğŸ“‹ æ ¹æœ¬çš„ç›£æŸ»ã‚µãƒãƒªãƒ¼")
    print("=" * 120)
    
    critical_findings = {
        "ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«å•é¡Œ": [
            "parsed_slots_countã®æ„å‘³ã®æ›–æ˜§æ€§ã«ã‚ˆã‚‹äºŒé‡å¤‰æ›ãƒªã‚¹ã‚¯",
            "æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨Phase 2å®Ÿè£…ã®è¨ˆç®—å‰æã®ä¸æ•´åˆ", 
            "æ™‚é–“å˜ä½ãƒ‡ãƒ¼ã‚¿ã®æ‰±ã„ã«é–¢ã™ã‚‹æ ¹æœ¬çš„è¨­è¨ˆæ¬ é™¥",
            "æ³•çš„æº–æ‹ ãƒã‚§ãƒƒã‚¯ã®æ•°å€¤çš„ä¿¡é ¼æ€§å•é¡Œ"
        ],
        "å½±éŸ¿ç¯„å›²": [
            "Phase 2: åŸºæœ¬äº‹å®ŸæŠ½å‡ºã®åŠ´åƒæ™‚é–“è¨ˆç®—",
            "Phase 3.1: ç•°å¸¸æ¤œçŸ¥ã®åŠ´åƒæ™‚é–“é–¾å€¤åˆ¤å®š",
            "çµ±åˆãƒ•ã‚¡ã‚¯ãƒˆãƒ–ãƒƒã‚¯: å…¨ã¦ã®æ™‚é–“ãƒ™ãƒ¼ã‚¹åˆ†æ",
            "æ³•çš„æº–æ‹ : åŠ´åƒåŸºæº–æ³•ã®æ™‚é–“åˆ¶é™ãƒã‚§ãƒƒã‚¯"
        ],
        "ç·Šæ€¥å¯¾å¿œé …ç›®": [
            "1. å®Ÿãƒ‡ãƒ¼ã‚¿ã§ã®parsed_slots_countå€¤ã®ç¢ºèª",
            "2. æ—¢å­˜shortage.pyã¨ã®è¨ˆç®—çµæœæ¯”è¼ƒ",
            "3. Phase 2/3.1ã®æ™‚é–“è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ä¿®æ­£",
            "4. ãƒ‡ãƒ¼ã‚¿ä»•æ§˜æ›¸ã®æ˜ç¢ºåŒ–",
            "5. å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã®æ™‚é–“å¤‰æ›çµ±ä¸€"
        ],
        "å“è³ªã¸ã®å½±éŸ¿": [
            "æ•°å€¤ç²¾åº¦: æœ€å¤§50%ã®èª¤å·®å¯èƒ½æ€§",
            "æ³•çš„æº–æ‹ : æ ¹æœ¬çš„ãªåˆ¤å®šç²¾åº¦å•é¡Œ",
            "ã‚·ã‚¹ãƒ†ãƒ ä¿¡é ¼æ€§: è¨ˆç®—åŸºç›¤ã®ä¿¡é ¼æ€§ä½ä¸‹",
            "ç¬¬ä¸‰è€…è©•ä¾¡: 95.2%ã‚¹ã‚³ã‚¢ã®å†è©•ä¾¡å¿…è¦"
        ]
    }
    
    for category, items in critical_findings.items():
        print(f"\nğŸš¨ {category}:")
        for i, item in enumerate(items, 1):
            print(f"  {i}. {item}")
    
    # å„ªå…ˆåº¦è©•ä¾¡
    print(f"\nğŸ¯ å¯¾å¿œå„ªå…ˆåº¦:")
    priorities = [
        ("æœ€å„ªå…ˆ", "å®Ÿãƒ‡ãƒ¼ã‚¿ã§ã®parsed_slots_countæ„å‘³ã®ç¢ºèª"),
        ("é«˜å„ªå…ˆ", "Phase 2/3.1ã®æ™‚é–“è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ä¿®æ­£"),
        ("ä¸­å„ªå…ˆ", "ãƒ‡ãƒ¼ã‚¿ä»•æ§˜æ›¸ã®æ•´å‚™"),
        ("ä½å„ªå…ˆ", "é•·æœŸçš„ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ”¹å–„")
    ]
    
    for priority, action in priorities:
        priority_icon = "ğŸ”¥" if priority == "æœ€å„ªå…ˆ" else "âš ï¸" if priority == "é«˜å„ªå…ˆ" else "ğŸ“‹"
        print(f"  {priority_icon} {priority}: {action}")
    
    # ç·åˆè©•ä¾¡
    print(f"\nğŸ“Š ç·åˆè©•ä¾¡:")
    print("ğŸ”´ æ ¹æœ¬çš„ãªè¨ˆç®—åŸºç›¤ã«é‡å¤§ãªè¨­è¨ˆæ¬ é™¥ã‚’ç™ºè¦‹")
    print("ğŸ“‹ Phase 2/3ã®å®Ÿè£…ã¯è¡¨é¢çš„ãªçµ±åˆã«ç•™ã¾ã‚Šã€åŸºç›¤æ¤œè¨¼ãŒä¸ååˆ†")
    print("âš ï¸ ä¿®æ­£ç¯„å›²ãŒåºƒç¯„å›²ã«åŠã¶ãŸã‚ã€æ®µéšçš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒå¿…è¦")
    print("ğŸ¯ æ•°å€¤çš„ä¿¡é ¼æ€§ã®ç¢ºä¿ãŒæœ€å„ªå…ˆèª²é¡Œ")

if __name__ == "__main__":
    print("ğŸ” æ ¹æœ¬çš„è¨ˆç®—æ–¹æ³•ç›£æŸ»ã‚’é–‹å§‹ã—ã¾ã™...")
    
    audit_fundamental_calculation_logic()
    generate_fundamental_audit_summary()
    
    print(f"\n" + "=" * 120)
    print("ğŸ“ ç›£æŸ»çµè«–:")
    print("æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã®è¨ˆç®—åŸºç›¤ã«æ ¹æœ¬çš„ãªè¨­è¨ˆå•é¡Œã‚’ç™ºè¦‹ã€‚")
    print("Phase 2/3ã®å®Ÿè£…ã¯åŸºç›¤ç†è§£ä¸è¶³ã«ã‚ˆã‚Šé‡å¤§ãªè¨ˆç®—èª¤å·®ã‚’å«ã‚€å¯èƒ½æ€§ã€‚")
    print("ç·Šæ€¥çš„ãªæ¤œè¨¼ã¨ä¿®æ­£ãŒå¿…è¦ã€‚")
    print("âœ… æ ¹æœ¬çš„ç›£æŸ»å®Œäº†")