# Shift-Suite è¨­å®šè³‡æ–™é›†
## çµ±ä¸€åˆ†æç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - å®Œå…¨è¨­å®šãƒãƒ‹ãƒ¥ã‚¢ãƒ«

**Version:** 2.0  
**Date:** 2025-07-30  
**Status:** Production Ready  

---

## ğŸ“– ç›®æ¬¡

1. [ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å“²å­¦](#1-ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å“²å­¦)
2. [å‹•çš„ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆåŸå‰‡](#2-å‹•çš„ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆåŸå‰‡)
3. [å…¨ä½“æœ€é©åŒ–ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#3-å…¨ä½“æœ€é©åŒ–ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
4. [æŠ€è¡“ä»•æ§˜ã¨APIä»•æ§˜](#4-æŠ€è¡“ä»•æ§˜ã¨apiä»•æ§˜)
5. [é‹ç”¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³](#5-é‹ç”¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³)
6. [è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è©³ç´°](#6-è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è©³ç´°)
7. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#7-ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å“²å­¦

### 1.1 åŸºæœ¬ç†å¿µ

**Shift-Suite**ã¯ã€**ã€Œå…¨ã¦ã¯å‹•çš„ã«ã€å…¨ã¦ã¯å…¨ä½“æœ€é©ã«ã€**ã‚’æ ¹æœ¬å“²å­¦ã¨ã™ã‚‹çµ±ä¸€åˆ†æç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

#### ğŸ”„ å®Œå…¨å‹•çš„ä¸»ç¾©
- **ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã¯å‹•çš„**ï¼šå›ºå®šå€¤ã‚„ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ’é™¤
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é©å¿œ**ï¼šãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å¤‰åŒ–ã«å³åº§ã«å¯¾å¿œ
- **è¨­å®šé§†å‹•å‹**ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨­å®šã«åŸºã¥ãå®Œå…¨æŸ”è»Ÿãªå‡¦ç†

#### ğŸŒ å…¨ä½“æœ€é©åŒ–åŸå‰‡
- **å€‹åˆ¥æœ€é©ã®æ’é™¤**ï¼šéƒ¨åˆ†çš„ãªä¿®æ­£ã§ã¯ãªãã€ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®èª¿å’Œã‚’è¿½æ±‚
- **çµ±åˆçš„ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼**ï¼šåˆ†æçµæœã®ä¸€å…ƒç®¡ç†ã¨ä¸€è²«æ€§ä¿è¨¼
- **äºˆæ¸¬çš„ã‚¨ãƒ©ãƒ¼å‡¦ç†**ï¼šå•é¡Œç™ºç”Ÿå‰ã®äºˆé˜²çš„å¯¾ç­–

#### ğŸ—ï¸ æ‹¡å¼µæ€§ãƒ»ä¿å®ˆæ€§
- **MECEåŸå‰‡**ï¼šMutually Exclusive, Collectively Exhaustive
- **Truth-Driven Analysis**ï¼šå®Ÿãƒ‡ãƒ¼ã‚¿å„ªå…ˆã®åˆ†ææ‰‹æ³•
- **Memory-Efficient Design**ï¼šé•·æœŸé‹ç”¨ã«è€ãˆã‚‹åŠ¹ç‡çš„è¨­è¨ˆ

### 1.2 è¨­è¨ˆæ€æƒ³ã®èƒŒæ™¯

å¾“æ¥ã®ã‚·ãƒ•ãƒˆåˆ†æã‚·ã‚¹ãƒ†ãƒ ã§ã¯ä»¥ä¸‹ã®å•é¡ŒãŒé »ç™ºã—ã¦ã„ã¾ã—ãŸï¼š

âŒ **å•é¡Œç‚¹**
- å›ºå®šã•ã‚ŒãŸã‚¹ãƒ­ãƒƒãƒˆæ™‚é–“ï¼ˆ30åˆ†å›ºå®šï¼‰ã«ã‚ˆã‚‹æŸ”è»Ÿæ€§ã®æ¬ å¦‚
- å€‹åˆ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®æœ€é©åŒ–ã«ã‚ˆã‚‹å…¨ä½“ä¸æ•´åˆ
- ãƒ‡ãƒ¼ã‚¿å½¢å¼ã®å¤‰æ›´ã«å¯¾ã™ã‚‹è„†å¼±æ€§
- åˆ†æçµæœã®æ•£åœ¨ã«ã‚ˆã‚‹ç®¡ç†å›°é›£

âœ… **Shift-Suiteã®è§£æ±ºç­–**
- **å‹•çš„ã‚¹ãƒ­ãƒƒãƒˆè¨­å®š**ï¼š5åˆ†ã€œ1440åˆ†ï¼ˆ24æ™‚é–“ï¼‰ã®ä»»æ„è¨­å®š
- **çµ±ä¸€åˆ†æç®¡ç†ã‚·ã‚¹ãƒ†ãƒ **ï¼šå…¨åˆ†æçµæœã®ä¸€å…ƒåŒ–
- **é©å¿œå‹ãƒ‡ãƒ¼ã‚¿å‡¦ç†**ï¼šä»»æ„ã®Excelæ§‹é€ ã¸ã®å¯¾å¿œ
- **è‡ªå‹•å“è³ªä¿è¨¼**ï¼šãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®è‡ªå‹•æ¤œè¨¼

---

## 2. å‹•çš„ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆåŸå‰‡

### 2.1 ã‚³ã‚¢è¨­è¨ˆåŸå‰‡

#### ğŸ¯ **åŸå‰‡1: Configuration-Driven Everything**
ã™ã¹ã¦ã®è¨­å®šã¯å¤–éƒ¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã«ã‚ˆã£ã¦å‹•çš„ã«æ±ºå®šã•ã‚Œã¾ã™ã€‚

```python
# âŒ æ‚ªã„ä¾‹ï¼šå›ºå®šå€¤
SLOT_MINUTES = 30  # ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

# âœ… è‰¯ã„ä¾‹ï¼šå‹•çš„è¨­å®š
slot_minutes = get_dynamic_slot_minutes(config)  # è¨­å®šã‹ã‚‰å–å¾—
```

#### ğŸ”„ **åŸå‰‡2: Adaptive Data Processing**
ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å¤‰åŒ–ã«è‡ªå‹•é©å¿œã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

```python
# âœ… å‹•çš„ã‚«ãƒ©ãƒ æ¤œå‡º
def detect_available_columns(df):
    """åˆ©ç”¨å¯èƒ½ãªã‚«ãƒ©ãƒ ã‚’å‹•çš„ã«æ¤œå‡º"""
    score_columns = ['fatigue_score', 'final_score', 'balance_score']
    return next((col for col in score_columns if col in df.columns), None)
```

#### ğŸŒ **åŸå‰‡3: Global Consistency**
ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã§ä¸€è²«ã—ãŸçŠ¶æ…‹ã‚’ç¶­æŒã—ã¾ã™ã€‚

```python
# âœ… çµ±ä¸€åˆ†æç®¡ç†
class UnifiedAnalysisManager:
    """å…¨åˆ†æçµæœã®çµ±ä¸€ç®¡ç†"""
    def __init__(self):
        self.results_registry = {}  # ä¸€å…ƒåŒ–ã•ã‚ŒãŸãƒ¬ã‚¸ã‚¹ãƒˆãƒª
        self.converter = SafeDataConverter()  # å®‰å…¨ãªå‹å¤‰æ›
```

### 2.2 å‹•çš„è¨­å®šã‚·ã‚¹ãƒ†ãƒ 

#### ğŸ“‹ è¨­å®šéšå±¤
1. **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š** (`constants.py`)
2. **æ–½è¨­ã‚¿ã‚¤ãƒ—è¨­å®š** (`config/facility_types/*.json`)
3. **æ–½è¨­å›ºæœ‰è¨­å®š** (`config/facilities/*.json`)
4. **ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š** (Streamlitã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹)
5. **å®Ÿè¡Œæ™‚è¨­å®š** (åˆ†æå®Ÿè¡Œæ™‚ã®å‹•çš„èª¿æ•´)

#### ğŸ”§ å‹•çš„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¾‹

```python
# ã‚¹ãƒ­ãƒƒãƒˆæ™‚é–“ã®å‹•çš„è¨­å®š
DEFAULT_SLOT_MINUTES = 30
SLOT_RANGE = {
    "min": 5,      # æœ€å°5åˆ†
    "max": 1440,   # æœ€å¤§24æ™‚é–“
    "default": 30  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ30åˆ†
}

# å¤œå‹¤æ™‚é–“å¸¯ã®å‹•çš„å®šç¾©
NIGHT_SHIFT_CONFIG = {
    "start_time": "22:00",  # è¨­å®šå¯èƒ½
    "end_time": "05:59",    # è¨­å®šå¯èƒ½
    "timezone_aware": True  # ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¯¾å¿œ
}
```

### 2.3 å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

#### ğŸ­ Factory Pattern
è¨­å®šã«åŸºã¥ã„ã¦é©åˆ‡ãªã‚¯ãƒ©ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆ

```python
class AnalysisFactory:
    @staticmethod
    def create_analyzer(analysis_type: str, config: dict):
        """è¨­å®šã«åŸºã¥ãåˆ†æå™¨ã®å‹•çš„ç”Ÿæˆ"""
        analyzers = {
            'shortage': ShortageAnalyzer,
            'fatigue': FatigueAnalyzer,
            'fairness': FairnessAnalyzer
        }
        return analyzers[analysis_type](config)
```

#### ğŸ”Œ Strategy Pattern
å®Ÿè¡Œæ™‚ã«å‡¦ç†æ–¹æ³•ã‚’é¸æŠ

```python
class DataProcessingStrategy:
    def process_excel_data(self, file_path: str, slot_minutes: int):
        """ã‚¹ãƒ­ãƒƒãƒˆæ™‚é–“ã«å¿œã˜ãŸå‡¦ç†æˆ¦ç•¥ã®é¸æŠ"""
        if slot_minutes <= 15:
            return self._high_resolution_processing(file_path)
        elif slot_minutes <= 60:
            return self._standard_processing(file_path)
        else:
            return self._low_resolution_processing(file_path)
```

---

## 3. å…¨ä½“æœ€é©åŒ–ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 3.1 ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Streamlit Frontend                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Upload    â”‚  â”‚  Analysis   â”‚  â”‚   Reporting     â”‚     â”‚
â”‚  â”‚  Interface  â”‚  â”‚  Controls   â”‚  â”‚   Dashboard     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Unified Analysis Manager                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚               Results Registry                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  Shortage   â”‚ â”‚   Fatigue   â”‚ â”‚  Fairness   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚   Results   â”‚ â”‚   Results   â”‚ â”‚   Results   â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚            Safe Data Converter                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Dynamic Key Manager                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Analysis Modules                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  shortage   â”‚  â”‚   fatigue   â”‚  â”‚    fairness     â”‚     â”‚
â”‚  â”‚  analyzer   â”‚  â”‚  analyzer   â”‚  â”‚    analyzer     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   heatmap   â”‚  â”‚   forecast  â”‚  â”‚      cost       â”‚     â”‚
â”‚  â”‚  generator  â”‚  â”‚   engine    â”‚  â”‚    analyzer     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Data Layer                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Enhanced Data Ingestion               â”‚   â”‚
â”‚  â”‚  â€¢ Dynamic Excel Structure Detection               â”‚   â”‚
â”‚  â”‚  â€¢ Automatic Column Mapping                        â”‚   â”‚
â”‚  â”‚  â€¢ Data Quality Assessment                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ

#### ğŸ”„ çµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

1. **ãƒ‡ãƒ¼ã‚¿å–ã‚Šè¾¼ã¿** (`Enhanced Data Ingestion`)
   - Excelæ§‹é€ ã®å‹•çš„è§£æ
   - è‡ªå‹•ã‚«ãƒ©ãƒ ãƒãƒƒãƒ”ãƒ³ã‚°
   - ãƒ‡ãƒ¼ã‚¿å“è³ªè©•ä¾¡

2. **çµ±ä¸€å‰å‡¦ç†** (`Unified Analysis Manager`)
   - å‹å®‰å…¨å¤‰æ› (`SafeDataConverter`)
   - ã‚­ãƒ¼ç®¡ç† (`DynamicKeyManager`)
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

3. **ä¸¦åˆ—åˆ†æå®Ÿè¡Œ**
   - å„åˆ†æãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ç‹¬ç«‹å®Ÿè¡Œ
   - çµæœã®çµ±ä¸€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆåŒ–
   - ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¸ã®è‡ªå‹•ç™»éŒ²

4. **çµæœçµ±åˆ** (`AI Compatible Results`)
   - åˆ†æçµæœã®ä¸€å…ƒç®¡ç†
   - é‡è¤‡æ’é™¤ã¨æœ€æ–°çµæœé¸æŠ
   - ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆç”¨ãƒ‡ãƒ¼ã‚¿å¤‰æ›

### 3.3 å…¨ä½“æœ€é©åŒ–ã®å…·ä½“ä¾‹

#### ğŸ¯ **å•é¡Œï¼šã‚¹ãƒ­ãƒƒãƒˆæ™‚é–“ã®ä¸æ•´åˆ**

**å¾“æ¥ã®å€‹åˆ¥æœ€é©ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼š**
```python
# âŒ å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§å€‹åˆ¥ã«ã‚¹ãƒ­ãƒƒãƒˆæ™‚é–“ã‚’å®šç¾©
# shortage.py
SHORTAGE_SLOT_HOURS = 0.5

# fatigue.py  
FATIGUE_SLOT_MINUTES = 30

# heatmap.py
HEATMAP_INTERVAL = 1800  # ç§’
```

**Shift-Suiteã®å…¨ä½“æœ€é©ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼š**
```python
# âœ… çµ±ä¸€è¨­å®šã‚·ã‚¹ãƒ†ãƒ 
class DynamicSlotConfiguration:
    def __init__(self, slot_minutes: int):
        self.slot_minutes = slot_minutes
        self.slot_hours = slot_minutes / 60.0
        self.slot_seconds = slot_minutes * 60
    
    def get_compatible_value(self, target_unit: str):
        """è¦æ±‚ã•ã‚ŒãŸå˜ä½ã§ã®å€¤ã‚’è¿”ã™"""
        units = {
            'minutes': self.slot_minutes,
            'hours': self.slot_hours, 
            'seconds': self.slot_seconds
        }
        return units.get(target_unit, self.slot_minutes)
```

#### ğŸ¯ **å•é¡Œï¼šåˆ†æçµæœã®æ•£åœ¨**

**å¾“æ¥ã®å€‹åˆ¥æœ€é©ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼š**
```python
# âŒ å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒç‹¬ç«‹ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›
shortage_results.to_parquet("shortage_output.parquet")
fatigue_results.to_csv("fatigue_scores.csv")  
fairness_data.to_excel("fairness_report.xlsx")
```

**Shift-Suiteã®å…¨ä½“æœ€é©ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼š**
```python
# âœ… çµ±ä¸€çµæœç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
unified_manager = UnifiedAnalysisManager()

# å„åˆ†æã®çµæœã‚’çµ±ä¸€ã‚·ã‚¹ãƒ†ãƒ ã«ç™»éŒ²
shortage_result = unified_manager.create_shortage_analysis(file_name, scenario_key, data)
fatigue_result = unified_manager.create_fatigue_analysis(file_name, scenario_key, data)
fairness_result = unified_manager.create_fairness_analysis(file_name, scenario_key, data)

# AIå‘ã‘çµ±åˆãƒ¬ãƒãƒ¼ãƒˆã®è‡ªå‹•ç”Ÿæˆ
comprehensive_report = unified_manager.get_ai_compatible_results(file_pattern)
```

---

## 4. æŠ€è¡“ä»•æ§˜ã¨APIä»•æ§˜

### 4.1 ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶

#### ğŸ–¥ï¸ **å‹•ä½œç’°å¢ƒ**
- **Python:** 3.12 ä»¥ä¸Šï¼ˆå¿…é ˆï¼‰
- **ãƒ¡ãƒ¢ãƒª:** æœ€å° 4GBï¼ˆæ¨å¥¨ 8GBä»¥ä¸Šï¼‰
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸:** æœ€å° 2GBï¼ˆåˆ†æãƒ‡ãƒ¼ã‚¿ç”¨ï¼‰
- **OS:** Windows 10/11, macOS 10.15+, Linuxï¼ˆUbuntu 20.04+ï¼‰

#### ğŸ“¦ **ä¾å­˜é–¢ä¿‚**
```txt
# ã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
pandas>=2.2.0          # ãƒ‡ãƒ¼ã‚¿å‡¦ç†
numpy>=1.26.0           # æ•°å€¤è¨ˆç®—
openpyxl>=3.1.0         # Excelèª­ã¿è¾¼ã¿
streamlit>=1.44.0       # Webã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

# æ©Ÿæ¢°å­¦ç¿’ãƒ»çµ±è¨ˆ
scikit-learn>=1.4.2     # MLåˆ†æ
lightgbm>=4.3.0         # å‹¾é…ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°
prophet>=1.1.6          # æ™‚ç³»åˆ—äºˆæ¸¬

# å¯è¦–åŒ–
plotly>=5.20.0          # ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚°ãƒ©ãƒ•
matplotlib>=3.8.0       # é™çš„ã‚°ãƒ©ãƒ•

# æœ€é©åŒ–
ortools>=9.7.0          # åˆ¶ç´„æœ€é©åŒ–
```

### 4.2 APIä»•æ§˜

#### ğŸ”Œ **UnifiedAnalysisManager API**

```python
class UnifiedAnalysisManager:
    """çµ±ä¸€åˆ†æçµæœç®¡ç†ã‚·ã‚¹ãƒ†ãƒ """
    
    def __init__(self) -> None:
        """åˆæœŸåŒ–"""
        
    def create_shortage_analysis(
        self, 
        file_name: str, 
        scenario_key: str, 
        role_df: pd.DataFrame
    ) -> UnifiedAnalysisResult:
        """ä¸è¶³åˆ†æçµæœã®ä½œæˆ"""
        
    def create_fatigue_analysis(
        self,
        file_name: str,
        scenario_key: str, 
        fatigue_df: Optional[pd.DataFrame] = None,
        combined_df: Optional[pd.DataFrame] = None
    ) -> UnifiedAnalysisResult:
        """ç–²åŠ´åˆ†æçµæœã®ä½œæˆ"""
        
    def create_fairness_analysis(
        self,
        file_name: str,
        scenario_key: str,
        fairness_df: pd.DataFrame
    ) -> List[UnifiedAnalysisResult]:
        """å…¬å¹³æ€§åˆ†æçµæœã®ä½œæˆ"""
        
    def get_ai_compatible_results(
        self, 
        file_pattern: Optional[str] = None
    ) -> Dict[str, Any]:
        """AIåŒ…æ‹¬ãƒ¬ãƒãƒ¼ãƒˆç”¨çµæœå–å¾—"""
        
    def cleanup_old_results(
        self, 
        max_age_hours: int = 24
    ) -> None:
        """å¤ã„çµæœã®è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—"""
```

#### ğŸ”§ **è¨­å®šç®¡ç†API**

```python
# å‹•çš„è¨­å®šã®å–å¾—
import shift_suite.config as config

slot_minutes = config.get('slot_minutes', 30)
night_start = config.get('night_shift_start', '22:00')
facility_type = config.get('facility_type', 'general_hospital')

# è¨­å®šã®å‹•çš„æ›´æ–°
config.update({
    'slot_minutes': 15,
    'analysis_depth': 'comprehensive'
})
```

#### ğŸ“Š **åˆ†æå®Ÿè¡ŒAPI**

```python
# æ¨™æº–çš„ãªåˆ†æå®Ÿè¡Œãƒ•ãƒ­ãƒ¼
from shift_suite import shortage, fatigue, fairness

# 1. ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
data = load_excel_data(file_path, slot_minutes=30)

# 2. ä¸è¶³åˆ†æå®Ÿè¡Œ
shortage_result = shortage.analyze(data, config)

# 3. ç–²åŠ´åˆ†æå®Ÿè¡Œ  
fatigue_result = fatigue.analyze(data, config)

# 4. å…¬å¹³æ€§åˆ†æå®Ÿè¡Œ
fairness_result = fairness.analyze(data, config)

# 5. çµ±åˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
comprehensive_report = generate_comprehensive_report([
    shortage_result, fatigue_result, fairness_result
])
```

### 4.3 ãƒ‡ãƒ¼ã‚¿å½¢å¼ä»•æ§˜

#### ğŸ“‹ **Excelå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**

**å¿…é ˆã‚«ãƒ©ãƒ ï¼š**
- `date` ã¾ãŸã¯ `æ—¥ä»˜`ï¼šæ—¥ä»˜æƒ…å ±
- `staff_id` ã¾ãŸã¯ `è·å“¡ID`ï¼šè·å“¡è­˜åˆ¥å­
- `shift_code` ã¾ãŸã¯ `å‹¤å‹™ã‚³ãƒ¼ãƒ‰`ï¼šã‚·ãƒ•ãƒˆã‚³ãƒ¼ãƒ‰

**æ¨å¥¨ã‚«ãƒ©ãƒ ï¼š**
- `role` ã¾ãŸã¯ `è·ç¨®`ï¼šè·ç¨®æƒ…å ±
- `department` ã¾ãŸã¯ `éƒ¨ç½²`ï¼šéƒ¨ç½²æƒ…å ±
- `shift_start` ã¾ãŸã¯ `é–‹å§‹æ™‚é–“`ï¼šå‹¤å‹™é–‹å§‹æ™‚é–“
- `shift_end` ã¾ãŸã¯ `çµ‚äº†æ™‚é–“`ï¼šå‹¤å‹™çµ‚äº†æ™‚é–“

**å‹•çš„å¯¾å¿œï¼š**
- ã‚«ãƒ©ãƒ åã®è‡ªå‹•æ¤œå‡º
- æ—¥æœ¬èªãƒ»è‹±èªæ··åœ¨å¯¾å¿œ
- è¤‡æ•°ã‚·ãƒ¼ãƒˆå¯¾å¿œ

#### ğŸ“Š **å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**

```json
{
  "analysis_type": "comprehensive",
  "timestamp": "2025-07-30T10:00:00",
  "file_info": {
    "name": "ãƒ‡ã‚¤_ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿_ä¼‘æ—¥ç²¾ç·».xlsx",
    "size": 1024000,
    "sheets": ["å‹¤å‹™è¡¨", "è·å“¡ãƒã‚¹ã‚¿"]
  },
  "results": {
    "shortage_analysis": {
      "total_shortage_hours": 45.5,
      "shortage_events_count": 12,
      "affected_roles_count": 8,
      "severity_level": "medium"
    },
    "fatigue_analysis": {
      "avg_fatigue_score": 0.65,
      "high_fatigue_staff_count": 3,
      "total_staff_analyzed": 25
    },
    "fairness_analysis": {
      "avg_fairness_score": 0.82,
      "low_fairness_staff_count": 2,
      "improvement_rate": 0.92
    }
  },
  "metadata": {
    "processing_time_seconds": 2.34,
    "data_quality_score": 0.95,
    "config_used": {
      "slot_minutes": 30,
      "analysis_depth": "standard"
    }
  }
}
```

---

## 5. é‹ç”¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### 5.1 æ—¥å¸¸é‹ç”¨ãƒ•ãƒ­ãƒ¼

#### ğŸ”„ **æ¨™æº–åˆ†æãƒ•ãƒ­ãƒ¼**

1. **äº‹å‰æº–å‚™**
   ```bash
   # ä»®æƒ³ç’°å¢ƒã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆ
   source venv-py311/Scripts/activate  # Windows
   # ã¾ãŸã¯
   source venv-py311/bin/activate      # macOS/Linux
   ```

2. **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•**
   ```bash
   streamlit run app.py
   ```

3. **ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**
   - Excelãƒ•ã‚¡ã‚¤ãƒ«ã®é¸æŠ
   - ã‚·ãƒ¼ãƒˆé¸æŠï¼ˆè¤‡æ•°å¯¾å¿œï¼‰
   - è¨­å®šç¢ºèªï¼ˆã‚¹ãƒ­ãƒƒãƒˆæ™‚é–“ç­‰ï¼‰

4. **åˆ†æå®Ÿè¡Œ**
   - ä¸è¶³åˆ†æ â†’ ç–²åŠ´åˆ†æ â†’ å…¬å¹³æ€§åˆ†æã®é †åºæ¨å¥¨
   - å„åˆ†æå®Œäº†å¾Œã®çµæœç¢ºèª
   - ç•°å¸¸å€¤ã®æ—©æœŸç™ºè¦‹

5. **ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**
   - AIå‘ã‘åŒ…æ‹¬ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ
   - çµæœãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆZIPå½¢å¼ï¼‰
   - ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª

#### ğŸ“Š **å“è³ªç®¡ç†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**

**ãƒ‡ãƒ¼ã‚¿å“è³ªãƒã‚§ãƒƒã‚¯ï¼š**
- [ ] æ—¥ä»˜å½¢å¼ã®çµ±ä¸€æ€§
- [ ] è·å“¡IDã®é‡è¤‡ç¢ºèª
- [ ] ã‚·ãƒ•ãƒˆã‚³ãƒ¼ãƒ‰ã®å¦¥å½“æ€§
- [ ] æ™‚é–“ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§

**åˆ†æçµæœæ¤œè¨¼ï¼š**
- [ ] ä¸è¶³æ™‚é–“ã®å¦¥å½“æ€§ï¼ˆ0ä»¥ä¸Šã®å€¤ï¼‰
- [ ] ç–²åŠ´ã‚¹ã‚³ã‚¢ã®ç¯„å›²ï¼ˆ0-1ï¼‰
- [ ] å…¬å¹³æ€§æŒ‡æ¨™ã®ä¸€è²«æ€§
- [ ] ç•°å¸¸å€¤ã®æœ‰ç„¡

**ã‚·ã‚¹ãƒ†ãƒ å‹•ä½œç¢ºèªï¼š**
- [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®ç›£è¦–
- [ ] ãƒ­ã‚°ã‚¨ãƒ©ãƒ¼ã®ç¢ºèª
- [ ] å‡¦ç†æ™‚é–“ã®è¨˜éŒ²
- [ ] çµæœã®å®Œå…¨æ€§

### 5.2 ãƒˆãƒ©ãƒ–ãƒ«å¯¾å¿œ

#### ğŸš¨ **ä¸€èˆ¬çš„ãªå•é¡Œã¨è§£æ±ºç­–**

**å•é¡Œ1: ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼**
```
ImportError: cannot import name 'xxx' from 'shift_suite.tasks.xxx'
```
**è§£æ±ºç­–:**
```bash
# ä¾å­˜é–¢ä¿‚ã®å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt --force-reinstall
```

**å•é¡Œ2: Excelèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼**
```
UnicodeDecodeError: 'cp932' codec can't decode byte
```
**è§£æ±ºç­–:**
```python
# app.pyã§æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ˜ç¤ºçš„ã«æŒ‡å®š
pd.read_excel(file_path, encoding='utf-8')
```

**å•é¡Œ3: ãƒ¡ãƒ¢ãƒªä¸è¶³**
```
MemoryError: Unable to allocate array
```
**è§£æ±ºç­–:**
```python
# ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒ£ãƒ³ã‚¯å‡¦ç†ã‚’æœ‰åŠ¹åŒ–
large_file_config = {
    'chunk_size': 1000,
    'memory_efficient': True
}
```

#### ğŸ”§ **é«˜åº¦ãªãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**

**ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã®å–å¾—:**
```python
# ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®å¤‰æ›´
import logging
logging.getLogger('shift_suite').setLevel(logging.DEBUG)

# çµ±ä¸€ã‚·ã‚¹ãƒ†ãƒ ã®çŠ¶æ…‹ç¢ºèª
if hasattr(st.session_state, 'unified_analysis_manager'):
    manager = st.session_state.unified_analysis_manager
    print(f"ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚µã‚¤ã‚º: {len(manager.results_registry)}")
    print(f"ç™»éŒ²æ¸ˆã¿ã‚­ãƒ¼: {list(manager.results_registry.keys())}")
```

**è¨­å®šã®å‹•çš„ç¢ºèª:**
```python
# ç¾åœ¨ã®è¨­å®šã‚’ç¢ºèª
import shift_suite.config as config
current_config = config._load_config()
print(json.dumps(current_config, indent=2, ensure_ascii=False))
```

### 5.3 æ€§èƒ½æœ€é©åŒ–

#### âš¡ **å‡¦ç†é€Ÿåº¦ã®æœ€é©åŒ–**

**å¤§é‡ãƒ‡ãƒ¼ã‚¿å‡¦ç†ï¼š**
```python
# ãƒãƒ£ãƒ³ã‚¯å‡¦ç†ã®æ´»ç”¨
def process_large_dataset(file_path, chunk_size=1000):
    for chunk in pd.read_excel(file_path, chunksize=chunk_size):
        yield process_chunk(chunk)

# ä¸¦åˆ—å‡¦ç†ã®åˆ©ç”¨
from concurrent.futures import ProcessPoolExecutor
with ProcessPoolExecutor(max_workers=4) as executor:
    results = list(executor.map(analyze_chunk, data_chunks))
```

**ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ã®æ”¹å–„ï¼š**
```python
# ä¸è¦ãªãƒ‡ãƒ¼ã‚¿ã®æ—©æœŸå‰Šé™¤
def memory_efficient_analysis(data):
    result = perform_analysis(data)
    del data  # æ˜ç¤ºçš„ã«ãƒ¡ãƒ¢ãƒªè§£æ”¾
    gc.collect()
    return result
```

#### ğŸ“ˆ **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£è¨­å®š**

**æ–½è¨­è¦æ¨¡åˆ¥è¨­å®šï¼š**
```json
{
  "small_facility": {
    "max_staff": 50,
    "chunk_size": 500,
    "parallel_workers": 2
  },
  "large_facility": {
    "max_staff": 500,
    "chunk_size": 100,
    "parallel_workers": 8
  }
}
```

---

## 6. è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è©³ç´°

### 6.1 åŸºæœ¬ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

#### âš™ï¸ **æ™‚é–“è¨­å®š**

```python
# constants.py
DEFAULT_SLOT_MINUTES = 30        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ãƒ­ãƒƒãƒˆæ™‚é–“
SLOT_RANGE = {
    "min": 5,                    # æœ€å°ã‚¹ãƒ­ãƒƒãƒˆæ™‚é–“ï¼ˆåˆ†ï¼‰
    "max": 1440,                 # æœ€å¤§ã‚¹ãƒ­ãƒƒãƒˆæ™‚é–“ï¼ˆåˆ†ï¼‰
    "recommended": [15, 30, 60]  # æ¨å¥¨å€¤
}

# å¤œå‹¤æ™‚é–“å¸¯
NIGHT_START_TIME = dt.time(22, 0)  # 22:00
NIGHT_END_TIME = dt.time(5, 59)    # 05:59
```

#### ğŸ’° **ã‚³ã‚¹ãƒˆè¨­å®š**

```python
WAGE_RATES = {
    "regular_staff": 1500,        # æ­£è¦è·å“¡æ™‚çµ¦ï¼ˆå††ï¼‰
    "temporary_staff": 2200,      # æ´¾é£è·å“¡æ™‚çµ¦ï¼ˆå††ï¼‰
    "night_differential": 1.25,   # å¤œå‹¤æ‰‹å½“å€ç‡
    "weekend_differential": 1.1   # ä¼‘æ—¥æ‰‹å½“å€ç‡
}

COST_PARAMETERS = {
    "recruit_cost_per_hire": 200_000,     # æ¡ç”¨ã‚³ã‚¹ãƒˆï¼ˆå††ï¼‰
    "penalty_per_shortage_hour": 4_000,   # ä¸è¶³æ™‚é–“ãƒšãƒŠãƒ«ãƒ†ã‚£ï¼ˆå††ï¼‰
    "monthly_hours_fte": 160              # æœˆé–“æ¨™æº–åŠ´åƒæ™‚é–“
}
```

### 6.2 åˆ†æãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

#### ğŸ“Š **çµ±è¨ˆçš„é–¾å€¤**

```python
STATISTICAL_THRESHOLDS = {
    "confidence_level": 0.95,           # çµ±è¨ˆçš„ä¿¡é ¼æ°´æº–
    "correlation_threshold": 0.7,       # ç›¸é–¢åˆ†æé–¾å€¤
    "significance_alpha": 0.05,         # æœ‰æ„æ°´æº–
    "min_sample_size": 10,              # æœ€å°ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚º
    "high_confidence_threshold": 0.8    # é«˜ä¿¡é ¼åº¦åˆ¤å®šé–¾å€¤
}
```

#### ğŸ˜´ **ç–²åŠ´åº¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**

```python
FATIGUE_PARAMETERS = {
    "min_rest_hours": 11,               # æœ€å°ä¼‘æ†©æ™‚é–“ï¼ˆæ³•çš„è¦ä»¶ï¼‰
    "consecutive_3_days_weight": 0.6,   # 3é€£å‹¤é‡ã¿
    "consecutive_4_days_weight": 0.3,   # 4é€£å‹¤é‡ã¿
    "night_shift_threshold": 0.3,       # å¤œå‹¤æ¯”ç‡é–¾å€¤
    "fatigue_alert_threshold": 0.8      # ç–²åŠ´ã‚¢ãƒ©ãƒ¼ãƒˆé–¾å€¤
}
```

#### ğŸ‘¥ **ãƒãƒ¼ãƒ ãƒ€ã‚¤ãƒŠãƒŸã‚¯ã‚¹**

```python
TEAM_DYNAMICS_PARAMETERS = {
    "compatibility_threshold_excellent": 0.9,  # ç›¸æ€§å„ªç§€é–¾å€¤
    "emergency_score_threshold": 0.6,          # ç·Šæ€¥å¯¾å¿œåŸºæœ¬é–¾å€¤
    "learning_default_speed": 0.5,             # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå­¦ç¿’é€Ÿåº¦
    "mentoring_capacity_default": 0.5,         # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæŒ‡å°èƒ½åŠ›
    "stress_high_threshold": 0.8               # é«˜ã‚¹ãƒˆãƒ¬ã‚¹è€æ€§é–¾å€¤
}
```

### 6.3 æ–½è¨­ã‚¿ã‚¤ãƒ—åˆ¥è¨­å®š

#### ğŸ¥ **åŒ»ç™‚æ–½è¨­ã‚¿ã‚¤ãƒ—**

```json
// config/facility_types/general_hospital.json
{
  "facility_type": "general_hospital",
  "display_name": "ç·åˆç—…é™¢",
  "slot_minutes_default": 30,
  "night_shift_mandatory": true,
  "minimum_staff_ratios": {
    "nurse": 0.6,
    "doctor": 0.2,
    "support": 0.2
  },
  "quality_requirements": {
    "minimum_experience_ratio": 0.4,
    "maximum_consecutive_days": 4,
    "emergency_response_required": true
  }
}
```

```json
// config/facility_types/nursing_home.json  
{
  "facility_type": "nursing_home",
  "display_name": "ä»‹è­·æ–½è¨­",
  "slot_minutes_default": 60,
  "night_shift_mandatory": true,
  "minimum_staff_ratios": {
    "care_worker": 0.7,
    "nurse": 0.2,
    "support": 0.1
  },
  "quality_requirements": {
    "minimum_experience_ratio": 0.3,
    "maximum_consecutive_days": 5,
    "emergency_response_required": false
  }
}
```

#### ğŸ¢ **å€‹åˆ¥æ–½è¨­è¨­å®š**

```json
// config/facilities/sample_hospital.json
{
  "facility_id": "hospital_001",
  "facility_name": "â—‹â—‹ç·åˆç—…é™¢",
  "facility_type": "general_hospital",
  "custom_settings": {
    "slot_minutes": 15,
    "night_premium_rate": 1.3,
    "weekend_premium_rate": 1.2,
    "holiday_calendar": "japan_national_holidays"
  },
  "departments": {
    "ICU": {
      "minimum_staff": 3,
      "required_certification": ["ICU_specialist"],
      "night_shift_ratio": 1.0
    },
    "general_ward": {
      "minimum_staff": 2,
      "night_shift_ratio": 0.8
    }
  }
}
```

---

## 7. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 7.1 ä¸€èˆ¬çš„ãªå•é¡Œ

#### ğŸš¨ **èµ·å‹•æ™‚ã‚¨ãƒ©ãƒ¼**

**ã‚¨ãƒ©ãƒ¼:** `ModuleNotFoundError: No module named 'pandas'`
```bash
# è§£æ±ºç­–1: ä»®æƒ³ç’°å¢ƒã®ç¢ºèª
which python
which pip

# è§£æ±ºç­–2: ä¾å­˜é–¢ä¿‚ã®å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  
pip install -r requirements.txt

# è§£æ±ºç­–3: ä»®æƒ³ç’°å¢ƒã®å†ä½œæˆ
python -m venv venv-new
source venv-new/Scripts/activate
pip install -r requirements.txt
```

**ã‚¨ãƒ©ãƒ¼:** `UnicodeEncodeError: 'cp932' codec can't encode character`
```python
# è§£æ±ºç­–: ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
import os
os.environ['PYTHONIOENCODING'] = 'utf-8'

# ã¾ãŸã¯èµ·å‹•æ™‚ã«æŒ‡å®š
set PYTHONIOENCODING=utf-8 && streamlit run app.py
```

#### ğŸ“Š **ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚¨ãƒ©ãƒ¼**

**ã‚¨ãƒ©ãƒ¼:** `shortage hours calculated as 0`
```python
# è¨ºæ–­: ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®ç¢ºèª
import logging
logging.getLogger('shift_suite').setLevel(logging.DEBUG)

# ç¢ºèªãƒã‚¤ãƒ³ãƒˆ:
# 1. ã‚¹ãƒ­ãƒƒãƒˆæ™‚é–“ã®è¨­å®š
# 2. ãƒ‡ãƒ¼ã‚¿ã®å‹å¤‰æ›
# 3. çµ±ä¸€ã‚·ã‚¹ãƒ†ãƒ ã®ç™»éŒ²çŠ¶æ³
```

**ã‚¨ãƒ©ãƒ¼:** `Empty results from unified analysis manager`
```python
# è¨ºæ–­æ‰‹é †:
if hasattr(st.session_state, 'unified_analysis_manager'):
    manager = st.session_state.unified_analysis_manager
    print(f"Registry size: {len(manager.results_registry)}")
    print(f"Available keys: {list(manager.results_registry.keys())}")
    
    # ãƒ•ã‚¡ã‚¤ãƒ«åãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¢ºèª
    from pathlib import Path
    file_stem = Path(uploaded_file.name).stem
    print(f"Searching for pattern: {file_stem}")
```

### 7.2 é«˜åº¦ãªãƒ‡ãƒãƒƒã‚°

#### ğŸ” **ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ã®è¨ºæ–­**

```python
def system_health_check():
    """ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯"""
    checks = []
    
    # 1. ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯
    try:
        import pandas, numpy, streamlit, plotly
        checks.append("âœ… Core dependencies: OK")
    except ImportError as e:
        checks.append(f"âŒ Missing dependency: {e}")
    
    # 2. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯
    config_path = Path("shift_suite/config.json")
    if config_path.exists():
        checks.append("âœ… Config file: Found")
    else:
        checks.append("âŒ Config file: Missing")
    
    # 3. ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãƒã‚§ãƒƒã‚¯
    import psutil
    memory_percent = psutil.virtual_memory().percent
    if memory_percent < 80:
        checks.append(f"âœ… Memory usage: {memory_percent}%")
    else:
        checks.append(f"âš ï¸ High memory usage: {memory_percent}%")
    
    return checks
```

#### ğŸ“ˆ **æ€§èƒ½ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°**

```python
import cProfile
import pstats

def profile_analysis(data_file):
    """åˆ†æå‡¦ç†ã®æ€§èƒ½ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°"""
    profiler = cProfile.Profile()
    profiler.enable()
    
    # åˆ†æå®Ÿè¡Œ
    result = run_comprehensive_analysis(data_file)
    
    profiler.disable()
    stats = pstats.Stats(profiler)
    stats.sort_stats('cumulative')
    stats.print_stats(10)  # ä¸Šä½10ä»¶ã®è¡¨ç¤º
    
    return result
```

### 7.3 ãƒ­ã‚°åˆ†æ

#### ğŸ“ **ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹é€ **

```
shift_suite.log
â”œâ”€â”€ [INFO] ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ãƒ­ã‚°
â”œâ”€â”€ [DEBUG] ãƒ‡ãƒ¼ã‚¿å‡¦ç†è©³ç´°  
â”œâ”€â”€ [WARNING] æ³¨æ„äº‹é …
â”œâ”€â”€ [ERROR] ã‚¨ãƒ©ãƒ¼æƒ…å ±
â””â”€â”€ [CRITICAL] é‡å¤§ãªå•é¡Œ

shortage_analysis.log  
â”œâ”€â”€ [INFO] ä¸è¶³åˆ†æã®è©³ç´°
â”œâ”€â”€ [DEBUG] ã‚¹ãƒ­ãƒƒãƒˆåˆ¥å‡¦ç†
â””â”€â”€ [WARNING] ãƒ‡ãƒ¼ã‚¿å“è³ªå•é¡Œ
```

#### ğŸ” **ãƒ­ã‚°è§£æã‚¹ã‚¯ãƒªãƒ—ãƒˆ**

```python
def analyze_logs(log_file="shift_suite.log"):
    """ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®è‡ªå‹•è§£æ"""
    error_patterns = []
    warning_patterns = []
    
    with open(log_file, 'r', encoding='utf-8') as f:
        for line_num, line in enumerate(f, 1):
            if '[ERROR]' in line:
                error_patterns.append((line_num, line.strip()))
            elif '[WARNING]' in line:
                warning_patterns.append((line_num, line.strip()))
    
    print(f"Errors found: {len(error_patterns)}")
    print(f"Warnings found: {len(warning_patterns)}")
    
    return {'errors': error_patterns, 'warnings': warning_patterns}
```

---

## ğŸ“š å‚è€ƒè³‡æ–™

### é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [STARTUP_GUIDE.md](./STARTUP_GUIDE.md) - åŸºæœ¬çš„ãªèµ·å‹•æ‰‹é †
- [README.md](./README.md) - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
- [COMPREHENSIVE_FIX_SUMMARY.md](./COMPREHENSIVE_FIX_SUMMARY.md) - æœ€æ–°ã®ä¿®æ­£å†…å®¹

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
- `shift_suite/config.json` - ãƒ¡ã‚¤ãƒ³è¨­å®š
- `shift_suite/tasks/constants.py` - ã‚·ã‚¹ãƒ†ãƒ å®šæ•°
- `requirements.txt` - ä¾å­˜é–¢ä¿‚å®šç¾©

### ã‚µãƒãƒ¼ãƒˆ
- GitHub Issues: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒªãƒã‚¸ãƒˆãƒªã®Issuesãƒšãƒ¼ã‚¸
- ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: `shift_suite.log`, `shortage_analysis.log`
- ãƒ‡ãƒãƒƒã‚°æƒ…å ±: Streamlitã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

---

**ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯å‹•çš„ã‚·ã‚¹ãƒ†ãƒ ã®è¨­è¨ˆæ€æƒ³ã‚’ä½“ç¾ã—ã¦ãŠã‚Šã€ã‚·ã‚¹ãƒ†ãƒ ã®æ‹¡å¼µã«åˆã‚ã›ã¦ç¶™ç¶šçš„ã«æ›´æ–°ã•ã‚Œã¾ã™ã€‚**

**æœ€çµ‚æ›´æ–°: 2025-07-30**  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 2.0**  
**æ–‡æ›¸ç®¡ç†: çµ±ä¸€åˆ†æç®¡ç†ã‚·ã‚¹ãƒ†ãƒ **